{% extends "base.html" %}
{% block title %}Visitor Application{% endblock %}
{% block pre_main %}
  {% include "partials/page_header.html" with title="Visitor Application" description="Read-only details for a visitor access request." %}
{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Applicant Details</h5>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'coaches:visitor_applications' %}">Back to list</a>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-4">Name</dt>
          <dd class="col-sm-8">{{ application.first_name }} {{ application.last_name }}</dd>

          <dt class="col-sm-4">IC Number</dt>
          <dd class="col-sm-8">{{ application.ic_number }}</dd>

          <dt class="col-sm-4">Application Date</dt>
          <dd class="col-sm-8">{{ application.application_date }}</dd>

          <dt class="col-sm-4">Status</dt>
          <dd class="col-sm-8">
            <span
              class="badge {% if application.status == 'Approved' %}bg-success{% elif application.status == 'Rejected' %}bg-danger{% else %}bg-warning text-dark{% endif %}">
              {{ application.get_status_display }}
            </span>
          </dd>
        </dl>

        {% with phones=application.phone_numbers.all emails=application.email_addresses.all %}
          {% if phones %}
          <h6 class="mt-3">Phone Numbers</h6>
          <ul class="mb-0">
            {% for phone in phones %}
            <li>{{ phone.phone_number }}</li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if emails %}
          <h6 class="mt-3">Email Addresses</h6>
          <ul class="mb-0">
            {% for email in emails %}
            <li>{{ email.email_address }}</li>
            {% endfor %}
          </ul>
          {% endif %}
        {% endwith %}
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card mb-4">
      <div class="card-header">Processing Status</div>
      <div class="card-body">
        {% if application.status == 'Pending' %}
        <p class="text-muted mb-0">Awaiting review by management. Coaches have read-only visibility.</p>
        {% else %}
        <p class="mb-2">
          Processed by:
          {% if application.approved_by %}
            {{ application.approved_by.member.first_name }} {{ application.approved_by.member.last_name }}
          {% else %}
            <span class="text-muted">N/A</span>
          {% endif %}
        </p>
        <p class="mb-2">Processed on: {{ application.approval_date|default:"N/A" }}</p>
        {% if application.reject_reason %}
        <div class="mb-0">
          <strong>Decision Notes:</strong>
          <div class="text-muted">{{ application.reject_reason }}</div>
        </div>
        {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
